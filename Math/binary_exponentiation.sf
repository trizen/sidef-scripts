#!/usr/bin/ruby

# Generic implementation of the Binary Exponentiation algorithm.

# See also:
#   https://en.wikipedia.org/wiki/Exponentiation_by_squaring

func binary_exp(a,b,c,f) {

    for bit in (b.as_bin.flip.chars) {
        c = f(a, c) if bit
        a = f(a, a)
    }

    return c
}

say binary_exp(3, 42, 1, {|a,b| a * b })  # 3^42
say binary_exp(3, 42, 0, {|a,b| a + b })  # 3*42
